<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shift Reduce Parser</title>
    <link href=favicon.ico? rel="shortcut icon" type=image/x-icon>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<!--<h1>Shift Reduce Parser</h1>-->
<img alt="Shift Reduce Parser!" height="auto" src="logo.png"
     width="35%"/>
<marquee direction="left"><p>CSC 4101 Honors Option</p></marquee>

<div class="container">

<table border="1" id="parser" style="
    width: 500px;
    height: 300px;">
    <caption>Parser Table</caption>
    <tr>
        <th colspan = "1" scope="colgroup"></th>
        <th colspan = "6" scope="colgroup">Action</th>
        <th colspan = "3" scope="colgroup">Goto</th>

    </tr>
    <tbody>
    <tr>
        <th scope="row">State</th>
        <td>id</td>
        <td>+</td>
        <td>*</td>
        <td>(</td>
        <td>)</td>
        <td>$</td>
        <td>E</td>
        <td>T</td>
        <td>F</td>
    </tr>
    <tr>
        <th scope="row">0</th>
        <td>S5</td>
        <td></td>
        <td></td>
        <td>S4</td>
        <td></td>
        <td></td>
        <td>1</td>
        <td>2</td>
        <td>3</td>
    </tr>
    <tr>
        <th scope="row">1</th>
        <td></td>
        <td>S6</td>
        <td></td>
        <td></td>
        <td></td>
        <td>accept</td>
        <td></td>
        <td></td>
        <td></td>

    </tr>
    <tr>
        <th scope="row">2</th>
        <td></td>
        <td>R2</td>
        <td>R7</td>
        <td></td>
        <td>R2</td>
        <td>R2</td>
        <td></td>
        <td></td>
        <td></td>

    </tr>
    <tr>
        <th scope="row">3</th>
        <td></td>
        <td>R4</td>
        <td>R4</td>
        <td></td>
        <td>R4</td>
        <td>R4</td>
        <td></td>
        <td></td>
        <td></td>
    </tr>
    <tr>
        <th scope="row">4</th>
        <td>S5</td>
        <td></td>
        <td></td>
        <td>S4</td>
        <td></td>
        <td></td>
        <td>8</td>
        <td>2</td>
        <td>3</td>
    </tr>
    <tr>
        <th scope="row">5</th>
        <td></td>
        <td>R6</td>
        <td>R6</td>
        <td></td>
        <td>R6</td>
        <td>R6</td>
        <td></td>
        <td></td>
        <td></td>
    </tr>
    <tr>
        <th scope="row">6</th>
        <td>S5</td>
        <td></td>
        <td></td>
        <td>S4</td>
        <td></td>
        <td></td>
        <td></td>
        <td>9</td>
        <td>3</td>
    </tr>
    <tr>
        <th scope="row">7</th>
        <td>S5</td>
        <td></td>
        <td></td>
        <td>S4</td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td>10</td>
    </tr>
    <tr>
        <th scope="row">8</th>
        <td></td>
        <td>S6</td>
        <td></td>
        <td></td>
        <td>S11</td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
    </tr>
    <tr>
        <th scope="row">9</th>
        <td></td>
        <td>R1</td>
        <td>S7</td>
        <td></td>
        <td>R1</td>
        <td>R1</td>
        <td></td>
        <td></td>
        <td></td>
    </tr>
    <tr>
        <th scope="row">10</th>
        <td></td>
        <td>R3</td>
        <td>R3</td>
        <td></td>
        <td>R3</td>
        <td>R3</td>
        <td></td>
        <td></td>
        <td></td>
    </tr>
    <tr>
        <th scope="row">11</th>
        <td></td>
        <td>R5</td>
        <td>R5</td>
        <td></td>
        <td>R5</td>
        <td>R5</td>
        <td></td>
        <td></td>
        <td></td>
    </tr>

    </tbody>
</table>


    <div style="border: 1px solid black; width: 300px;">
        <p style="margin-left: 15px">
            Grammar<br><br>
            1.E→E +T <br>
            2. E → T <br>
            3. T → T * F <br>
            4. T → F <br>
            5. F → (E) <br>
            6. F → id </p>
    </div>

</div>

<div class="container">

<table border="1" id="output" style="
    width: 200px;">
    <caption>Output</caption>
</table>

    <input type="text" id="expression" name="expression" placeholder="Enter an expression...">
    <button onclick="step()">Step</button>

</div>

<script>

    function getAction(expression){
        if(expression.substring(0,2) === "id"){
            return 1;
        }

        switch(expression.substring(0,1)) {
            case "+":
                return 2;
            case "*":
                return 3;
            case "(":
                return 4;
            case ")":
                return 5;
            case "$":
                return 6;
            case "E":
                return 7;
            case "T":
                return 8;
            case "F":
                return 9;
            default:
                console.log("Error, param \""+expression.substring(0,1)+"\" is invalid.");
        }

        return -1;
    }

    function getState(parsed){
        if(parsed.substring(parsed.length-2,parsed.length) === "11"){
            return 11;
        }
        else if(parsed.substring(parsed.length-2,parsed.length) === "10"){
            return 10;
        }

        return Number(parsed.substring(parsed.length-1,parsed.length))
    }

    function grammarReplacement(parsed,oldElement,newElement){
        for(var i = parsed.length; i > oldElement.length; i--){
            if(parsed.substring(i-oldElement.length,i) === oldElement){
                return parsed.substring(0,i-oldElement.length) + newElement + parsed.substring(i,parsed.length);
            }
        }
        return "error";
    }

    function grammar(grammar,parsed){
        console.log("grammer evaled: " + grammar);
        console.log("parsed: " + parsed);

        switch (grammar)
        {
            case 1:
                return grammarReplacement(parsed,"E+T","E"),"E";
            case 2:
                return grammarReplacement(parsed,"E","T"),"T";
            case 3:
                return grammarReplacement(parsed,"T","T*F"),"T*F";
            case 4:
                return grammarReplacement(parsed,"T","F"),"F";
            case 5:
                return grammarReplacement(parsed,"F","(E)"),"(E)";
            case 6:
                return grammarReplacement(parsed,"F","id"),"id";
        }
    }

    function shift(parsed, expression, shiftBy, action){
        console.log("action" + action);
        parsed = parsed + action + shiftBy;

        expression = expression.substring(expression.indexOf(' ') + 1);


        return [parsed, expression];
    }

    function getGoto(state,goto){
        switch (goto){
            case "E":
                return  document.getElementById('parser').rows[state+2].cells[7].textContent;
            case "T":
                return  document.getElementById('parser').rows[state+2].cells[8].textContent;
            case "F":
                return  document.getElementById('parser').rows[state+2].cells[9].textContent;

        }
        return "Error";
    }

    function reduce(parsed, expression, grammar, action){
        let symbol;
        [parsed, symbol] = grammar(grammar, parsed)

        goto = getGoto(Number(action.substring(1,2)),symbol)

        return grammarReplacement(parsed,action.substring(1,2),getGoto)



    }

    function parse(parsed, expression){


        const action = getAction(expression);
        const state = getState(parsed);

        console.log("action: " +action + ". state: " + state);

        const element = document.getElementById('parser').rows[action+1].cells[state+1].textContent;
        console.log("element: " +element);
        if(element.substring(0,1) === "S"){
            console.log("Shifting");
            [parsed, expression] = shift(parsed, expression, Number(element.substring(1,2)), expression.substring(0,2) === "id"? "id" : element.substring(1,2),expression.substring(0,1))
        } else if(element.substring(0,1) === "R"){
            console.log("Reducing");
            parsed = reduce(parsed, expression, Number(element.substring(1,2)),action)
        } else {
            console.log("Grammar");
            parsed = grammar(Number(element),parsed)[0];
        }

        return [parsed, expression];
    }
    function insertItem(table, element1, element2){
        const row = table.insertRow(-1);
        const col1 = row.insertCell(0);
        const col2 = row.insertCell(1);
        col1.innerHTML = element1;
        col2.innerHTML = element2;
    }
    function step() {
        const table = document.getElementById("output");


        if (table.rows.length === 0) {
            insertItem(table, "0", document.getElementById("expression").value)
            console.log("firstrow");

        } else {

            var expression = table.rows[table.rows.length-1].cells[1].innerHTML;
            var parsed = table.rows[table.rows.length-1].cells[0].innerHTML;

            [parsed, expression] = parse(parsed, expression)



            insertItem(table, parsed, expression)

        }


    }

</script>


</body>
</html>
